<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Simple Grammar Checker</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&family=Courier+Prime&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background: #f1f5f9; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        
        .btn-group { text-align: center; margin-bottom: 20px; }
        button { 
            padding: 12px 30px; font-size: 18px; font-weight: bold; cursor: pointer; 
            border: none; border-radius: 5px; color: white; transition: 0.2s;
        }
        .btn-check { background-color: #2563eb; }
        .btn-check:active { background-color: #1e40af; transform: scale(0.95); }
        .btn-reset { background-color: #ef4444; margin-left: 10px; }

        textarea, .output { 
            width: 100%; height: 300px; padding: 15px; 
            border: 2px solid #ccc; border-radius: 8px; 
            font-family: 'Courier Prime', monospace; font-size: 16px; 
            box-sizing: border-box; resize: vertical;
        }
        .output { background: #fff; overflow-y: auto; white-space: pre-wrap; margin-top: 10px; }

        /* Highlight Colors */
        .err { border-bottom: 3px solid; cursor: help; position: relative; }
        .err:hover::after {
            content: attr(data-fix);
            position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);
            background: black; color: white; padding: 5px 10px; border-radius: 5px; 
            font-size: 14px; white-space: nowrap; z-index: 10;
        }
        
        .red { background: #fee2e2; color: #dc2626; border-color: #dc2626; } /* Spelling */
        .green { background: #dcfce7; color: #16a34a; border-color: #16a34a; } /* Grammar */
        .orange { background: #ffedd5; color: #ea580c; border-color: #ea580c; } /* Article */
        .blue { background: #e0f2fe; color: #0284c7; border-color: #0284c7; } /* Punctuation */
    </style>
</head>
<body>

<div class="container">
    <h1>Grammar Checker (Direct Fix)</h1>
    
    <div class="btn-group">
        <button class="btn-check" id="checkBtn" onclick="startCheck()">üîç RUN CHECK</button>
        <button class="btn-reset" onclick="location.reload()">üóëÔ∏è RESET</button>
    </div>

    <div>
        <label><strong>Input:</strong></label>
        <textarea id="inp">He have a car. I did went home tommorow. Teh book is good .</textarea>
    </div>
    
    <div>
        <label><strong>Result:</strong></label>
        <div id="out" class="output"></div>
    </div>
</div>

<script>
    // --- 1. ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏é (Rules) ---
    const rules = [
        // SPELLING (Red)
        { pat: /\b(teh)\b/gi, fix: "the", color: "red" },
        { pat: /\b(recieve)\b/gi, fix: "receive", color: "red" },
        { pat: /\b(tommorow)\b/gi, fix: "tomorrow", color: "red" },
        { pat: /\b(untill)\b/gi, fix: "until", color: "red" },
        
        // ARTICLES (Orange)
        { pat: /\b(a)\s+(apple|elephant|ice|orange|umbrella)\b/gi, fix: "an $2", color: "orange" },
        { pat: /\b(an)\s+(car|book|house|year)\b/gi, fix: "a $2", color: "orange" },

        // GRAMMAR (Green)
        { pat: /\b(he|she|it)\s+(have)\b/gi, fix: "has", color: "green" },
        { pat: /\b(I)\s+(has)\b/gi, fix: "have", color: "green" },
        { pat: /\b(did|didn't)\s+(went|saw|ate|came)\b/gi, fix: "did + verb1", color: "green" },
        { pat: /\b(to)\s+(went|goes)\b/gi, fix: "to go", color: "green" },

        // PUNCTUATION (Blue)
        { pat: /\s+([.,?!])/g, fix: "$1", color: "blue" },
        { pat: /,([^ \n])/g, fix: ", $1", color: "blue" }
    ];

    // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°) ---
    function startCheck() {
        const btn = document.getElementById('checkBtn');
        const input = document.getElementById('inp');
        const output = document.getElementById('out');
        let text = input.value;

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
        btn.innerText = "Checking...";
        
        setTimeout(() => {
            if (!text.trim()) {
                output.innerHTML = "Please type something...";
                btn.innerText = "üîç RUN CHECK";
                return;
            }

            let findings = [];

            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏Å‡∏é
            rules.forEach(r => {
                let match;
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Regex ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                let regex = new RegExp(r.pat); 
                
                while ((match = regex.exec(text)) !== null) {
                    let suggestion = r.fix;
                    // ‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤ $1, $2 ‡πÉ‡∏ô suggestion
                    if (suggestion.includes("$")) {
                        suggestion = match[0].replace(regex, r.fix);
                    }

                    findings.push({
                        start: match.index,
                        end: match.index + match[0].length,
                        word: match[0],
                        suggest: suggestion,
                        color: r.color
                    });

                    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏•‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏ö
                    if (match.index === regex.lastIndex) regex.lastIndex++;
                }
            });

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á
            findings.sort((a, b) => a.start - b.start);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML
            let html = "";
            let cursor = 0;

            findings.forEach(item => {
                if (item.start < cursor) return; // ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
                html += escapeHtml(text.substring(cursor, item.start));

                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå
                html += `<span class="err ${item.color}" data-fix="‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô: ${item.suggest}">${escapeHtml(item.word)}</span>`;

                cursor = item.end;
            });

            // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            html += escapeHtml(text.substring(cursor));
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            output.innerHTML = html;

            // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°
            btn.innerText = "üîç RUN CHECK";
            
        }, 200); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
    }

    function escapeHtml(text) {
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }
</script>

</body>
</html>
