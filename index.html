<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple English Grammar Checker</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f3f4f6;
            --surface-color: #ffffff;
            --error-color: #dc2626;
            --warning-color: #d97706;
            --text-color: #1f2937;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--surface-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: var(--primary-color);
        }

        .editor-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-box, .output-box {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }

        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            resize: vertical;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
        }

        .output-div {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background-color: #fafafa;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
        }

        /* Styles for errors */
        .highlight-error {
            text-decoration: underline wavy var(--error-color);
            background-color: rgba(220, 38, 38, 0.1);
            cursor: pointer;
            position: relative;
        }

        .highlight-error:hover::after {
            content: attr(data-suggestion);
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
            margin-right: 10px;
        }

        .btn:hover {
            background-color: #1d4ed8;
        }

        .btn-print {
            background-color: #059669;
        }

        .summary-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #eff6ff;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
        }

        /* Print Specific Styles */
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                width: 100%;
                max-width: 100%;
            }
            .input-box, .btn, .controls {
                display: none !important;
            }
            .output-box {
                flex: 100%;
                border: none;
            }
            .output-div {
                border: none;
                height: auto;
                background-color: white;
            }
            .highlight-error {
                text-decoration: none;
                font-weight: bold;
                color: var(--error-color);
            }
            /* Show suggestions in print next to the word */
            .highlight-error::after {
                content: " [" attr(data-suggestion) "] ";
                position: static;
                background: none;
                color: var(--text-color);
                font-size: inherit;
                font-weight: normal;
                transform: none;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>üìù English Grammar Checker</h1>
            <p>‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå</p>
        </header>

        <div class="controls">
            <button class="btn" onclick="checkGrammar()">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Check)</button>
            <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Print PDF)</button>
        </div>
        <br>

        <div class="editor-section">
            <div class="input-box">
                <label><strong>‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (Input):</strong></label>
                <textarea id="inputText" placeholder="Type or paste your English text here... (e.g. He have a car. I want to went home.)"></textarea>
            </div>
            
            <div class="output-box">
                <label><strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à (Result):</strong></label>
                <div id="resultOutput" class="output-div"></div>
            </div>
        </div>

        <div id="summarySection" class="summary-section" style="display: none;">
            <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Summary)</h2>
            <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> <span id="errorCount">0</span> ‡∏à‡∏∏‡∏î</p>
            <ul id="suggestionList"></ul>
            <p><em>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</em></p>
        </div>
    </div>

    <script>
        // ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏é Grammar ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏é‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)
        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à Grammar ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API (‡πÄ‡∏ä‡πà‡∏ô LanguageTool) ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ Regex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡πá‡∏ï
        const grammarRules = [
            {
                pattern: /\b(he|she|it)\s+have\b/gi,
                suggestion: "has",
                reason: "Subject-Verb Agreement: ‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÄ‡∏≠‡∏Å‡∏û‡∏à‡∏ô‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ has"
            },
            {
                pattern: /\b(I)\s+has\b/gi,
                suggestion: "have",
                reason: "Subject-Verb Agreement: I ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ have"
            },
            {
                pattern: /\b(dont)\b/gi,
                suggestion: "don't",
                reason: "Punctuation: ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ apostrophe"
            },
            {
                pattern: /\b(cant)\b/gi,
                suggestion: "can't",
                reason: "Punctuation: ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ apostrophe"
            },
            {
                pattern: /\b(teh)\b/gi,
                suggestion: "the",
                reason: "Spelling: ‡∏™‡∏∞‡∏Å‡∏î‡∏ú‡∏¥‡∏î"
            },
            {
                pattern: /\b(your)\s+(welcome)\b/gi,
                suggestion: "you're welcome",
                reason: "Grammar: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ You are (You're)"
            },
            {
                pattern: /\b(to)\s+went\b/gi,
                suggestion: "to go",
                reason: "Infinitive: ‡∏´‡∏•‡∏±‡∏á to ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô verb ‡∏ä‡πà‡∏≠‡∏á 1"
            },
            {
                pattern: /\s{2,}/g,
                suggestion: " ",
                reason: "Format: ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏ã‡πâ‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô"
            }
        ];

        function checkGrammar() {
            const inputText = document.getElementById('inputText').value;
            const resultDiv = document.getElementById('resultOutput');
            const summarySection = document.getElementById('summarySection');
            const errorCountSpan = document.getElementById('errorCount');
            const suggestionList = document.getElementById('suggestionList');

            if (!inputText.trim()) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö");
                return;
            }

            let processedText = inputText;
            let errorsFound = [];
            
            // 1. ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
            // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Array ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ Highlight
            let matches = [];

            grammarRules.forEach(rule => {
                let match;
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï lastIndex ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö regex ‡∏ó‡∏µ‡πà‡∏°‡∏µ global flag
                const regex = new RegExp(rule.pattern);
                
                while ((match = regex.exec(inputText)) !== null) {
                    matches.push({
                        start: match.index,
                        end: match.index + match[0].length,
                        text: match[0],
                        suggestion: rule.suggestion,
                        reason: rule.reason
                    });
                }
            });

            // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö matches ‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏£‡∏Å tag ‡∏ú‡∏¥‡∏î‡∏ó‡∏µ‡πà)
            matches.sort((a, b) => a.start - b.start);

            // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Highlight
            let finalHtml = "";
            let lastIndex = 0;
            let totalErrors = 0;

            // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏Å‡πà‡∏≤
            suggestionList.innerHTML = "";

            matches.forEach((m) => {
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∏‡∏î‡∏ú‡∏¥‡∏î
                finalHtml += inputText.substring(lastIndex, m.start);
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏° Tag
                // ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (Overlap) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢
                if (m.start >= lastIndex) {
                    finalHtml += `<span class="highlight-error" title="${m.reason} -> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${m.suggestion}" data-suggestion="‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô: ${m.suggestion}">${m.text}</span>`;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏™‡∏£‡∏∏‡∏õ
                    let li = document.createElement('li');
                    li.innerHTML = `<strong>"${m.text}"</strong> ‡∏≠‡∏≤‡∏à‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${m.reason} <br> <span style="color:green">‚ûî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô: <strong>${m.suggestion}</strong></span>`;
                    suggestionList.appendChild(li);
                    
                    totalErrors++;
                    lastIndex = m.end;
                }
            });

            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            finalHtml += inputText.substring(lastIndex);

            // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            resultDiv.innerHTML = finalHtml;
            errorCountSpan.innerText = totalErrors;
            summarySection.style.display = "block";
        }
    </script>
</body>
</html>
