<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Grammar Checker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            padding: 40px; 
            border-radius: 15px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        h1 { 
            text-align: center; 
            color: #2d3748; 
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 14px;
        }

        label { 
            display: block;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 14px;
        }

        textarea { 
            width: 100%; 
            height: 180px; 
            padding: 15px; 
            border: 2px solid #e2e8f0; 
            border-radius: 10px; 
            font-size: 16px; 
            resize: vertical;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls { 
            text-align: center; 
            margin: 25px 0; 
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        button {
            padding: 14px 35px; 
            font-size: 16px; 
            font-weight: 600; 
            color: white;
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #btnCheck { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex: 1;
            max-width: 200px;
        }
        #btnCheck:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }
        #btnCheck:disabled { 
            background: #cbd5e0; 
            cursor: not-allowed;
            transform: none;
        }
        
        #btnReset { 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            flex: 1;
            max-width: 200px;
        }
        #btnReset:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(245, 87, 108, 0.4);
        }

        #result { 
            min-height: 180px; 
            padding: 20px; 
            border: 2px solid #e2e8f0; 
            border-radius: 10px; 
            background: #f7fafc; 
            line-height: 2; 
            font-size: 16px;
            color: #2d3748;
        }
        
        .empty-state {
            color: #a0aec0;
            text-align: center;
            font-style: italic;
            padding: 40px 20px;
        }

        .status { 
            margin: 15px 0; 
            text-align: center; 
            font-size: 14px;
            font-weight: 600;
        }
        
        .status.success { color: #38a169; }
        .status.error { color: #e53e3e; }
        .status.info { color: #3182ce; }

        .err { 
            border-bottom: 3px solid; 
            cursor: help; 
            position: relative; 
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
        }
        
        .err:hover::after {
            content: attr(data-tip);
            position: absolute; 
            bottom: 130%; 
            left: 50%; 
            transform: translateX(-50%);
            background: #1a202c; 
            color: #fff; 
            padding: 8px 14px; 
            border-radius: 6px;
            font-size: 13px; 
            white-space: nowrap; 
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .err:hover::before {
            content: '';
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1a202c;
            z-index: 100;
        }

        .c-spelling { 
            border-color: #e53e3e; 
            background: #fff5f5; 
            color: #c53030;
        }
        
        .c-grammar { 
            border-color: #38a169; 
            background: #f0fff4; 
            color: #276749;
        }
        
        .c-article { 
            border-color: #ed8936; 
            background: #fffaf0; 
            color: #c05621;
        }
        
        .c-tense { 
            border-color: #9f7aea; 
            background: #faf5ff; 
            color: #6b46c1;
        }
        
        .c-punctuation { 
            border-color: #3182ce; 
            background: #ebf8ff; 
            color: #2c5282;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            padding: 15px;
            background: #edf2f7;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid;
        }
        
        .legend-color.spelling { background: #fff5f5; border-color: #e53e3e; }
        .legend-color.grammar { background: #f0fff4; border-color: #38a169; }
        .legend-color.article { background: #fffaf0; border-color: #ed8936; }
        .legend-color.tense { background: #faf5ff; border-color: #9f7aea; }
        .legend-color.punctuation { background: #ebf8ff; border-color: #3182ce; }

        @media (max-width: 600px) {
            .container { padding: 20px; }
            h1 { font-size: 24px; }
            .controls { flex-direction: column; }
            button { max-width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>‚úçÔ∏è Advanced Grammar Checker</h1>
    <p class="subtitle">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå Tense ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï‡∏≠‡∏ô</p>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color spelling"></div>
            <span>Spelling (‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color grammar"></div>
            <span>Grammar (‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color tense"></div>
            <span>Tense (‡∏Å‡∏≤‡∏•)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color article"></div>
            <span>Articles (a/an/the)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color punctuation"></div>
            <span>Punctuation (‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï‡∏≠‡∏ô)</span>
        </div>
    </div>
    
    <label>üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</label>
    <textarea id="inputText" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>

    <div class="controls">
        <button id="btnCheck" onclick="checkGrammar()">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
        <button id="btnReset" onclick="resetForm()">üîÑ Reset</button>
    </div>
    
    <div class="status" id="status"></div>

    <label>üìã ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</label>
    <div id="result">
        <div class="empty-state">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"</div>
    </div>
</div>

<script>
    const rules = [
        // SPELLING ERRORS
        { pattern: /\bteh\b/gi, fix: "the", type: "c-spelling", category: "Spelling" },
        { pattern: /\brecieve\b/gi, fix: "receive", type: "c-spelling", category: "Spelling" },
        { pattern: /\btommorow\b/gi, fix: "tomorrow", type: "c-spelling", category: "Spelling" },
        { pattern: /\buntill\b/gi, fix: "until", type: "c-spelling", category: "Spelling" },
        { pattern: /\boccured\b/gi, fix: "occurred", type: "c-spelling", category: "Spelling" },
        { pattern: /\bseperate\b/gi, fix: "separate", type: "c-spelling", category: "Spelling" },
        { pattern: /\bdefinately\b/gi, fix: "definitely", type: "c-spelling", category: "Spelling" },
        { pattern: /\bneccessary\b/gi, fix: "necessary", type: "c-spelling", category: "Spelling" },
        { pattern: /\bwierd\b/gi, fix: "weird", type: "c-spelling", category: "Spelling" },
        { pattern: /\btheir\s+are\b/gi, fix: "there are", type: "c-spelling", category: "Spelling" },
        { pattern: /\byour\s+going\b/gi, fix: "you're going", type: "c-spelling", category: "Spelling" },
        
        // GRAMMAR ERRORS
        { pattern: /\b(he|she|it)\s+(have)\b/gi, fix: "has", type: "c-grammar", category: "Grammar" },
        { pattern: /\b(he|she|it)\s+(are)\b/gi, fix: "is", type: "c-grammar", category: "Grammar" },
        { pattern: /\b(I|you|we|they)\s+(has)\b/gi, fix: "have", type: "c-grammar", category: "Grammar" },
        { pattern: /\b(he|she|it)\s+don't\b/gi, fix: "doesn't", type: "c-grammar", category: "Grammar" },
        { pattern: /\b(I|you|we|they)\s+doesn't\b/gi, fix: "don't", type: "c-grammar", category: "Grammar" },
        { pattern: /\bmuch\s+(books|cars|people|things)\b/gi, fix: "many", type: "c-grammar", category: "Grammar" },
        { pattern: /\bmany\s+(water|money|time|information)\b/gi, fix: "much", type: "c-grammar", category: "Grammar" },
        
        // TENSE ERRORS
        { pattern: /\b(did|didn't)\s+(went|saw|ate|came|took)\b/gi, fix: "base verb", type: "c-tense", category: "Tense" },
        { pattern: /\bwill\s+(went|saw|ate)\b/gi, fix: "base verb", type: "c-tense", category: "Tense" },
        { pattern: /\b(has|have)\s+(went|saw|ate)\b/gi, fix: "past participle", type: "c-tense", category: "Tense" },
        { pattern: /\b(am|is|are)\s+(went|saw|ate)\b/gi, fix: "-ing form", type: "c-tense", category: "Tense" },
        
        // ARTICLE ERRORS
        { pattern: /\ba\s+(apple|orange|elephant|umbrella|hour|honest)\b/gi, fix: "an", type: "c-article", category: "Article" },
        { pattern: /\ba\s+(egg|ice|opportunity)\b/gi, fix: "an", type: "c-article", category: "Article" },
        { pattern: /\ban\s+(car|book|house|dog|cat|university)\b/gi, fix: "a", type: "c-article", category: "Article" },
        { pattern: /\ban\s+(pen|table|computer)\b/gi, fix: "a", type: "c-article", category: "Article" },
        
        // PUNCTUATION ERRORS
        { pattern: /\s{2,}([.,?!])/g, fix: "$1", type: "c-punctuation", category: "Punctuation" },
        { pattern: /,([a-zA-Z])/g, fix: ", $1", type: "c-punctuation", category: "Punctuation" },
        { pattern: /\.([A-Z])/g, fix: ". $1", type: "c-punctuation", category: "Punctuation" },
        { pattern: /\s{2,}/g, fix: " ", type: "c-punctuation", category: "Punctuation" }
    ];

    function checkGrammar() {
        const inputEl = document.getElementById('inputText');
        const outputEl = document.getElementById('result');
        const statusEl = document.getElementById('status');
        const btn = document.getElementById('btnCheck');
        
        const text = inputEl.value.trim();
        
        if (!text) {
            outputEl.innerHTML = '<div class="empty-state">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>';
            statusEl.innerHTML = '';
            return;
        }

        btn.disabled = true;
        btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
        statusEl.innerHTML = '<span class="info">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...</span>';
        outputEl.innerHTML = "";

        setTimeout(function() {
            try {
                let findings = [];
                let errorCount = {
                    spelling: 0,
                    grammar: 0,
                    tense: 0,
                    article: 0,
                    punctuation: 0
                };

                rules.forEach(function(rule) {
                    try {
                        let match;
                        const regex = new RegExp(rule.pattern.source, rule.pattern.flags);
                        
                        while ((match = regex.exec(text)) !== null) {
                            const offset = match.index;
                            const matchedText = match[0];
                            
                            let suggestion = rule.fix;
                            if (suggestion.indexOf("$1") !== -1 && match[1]) {
                                suggestion = suggestion.replace("$1", match[1]);
                            }

                            findings.push({
                                start: offset,
                                end: offset + matchedText.length,
                                word: matchedText,
                                tip: suggestion,
                                type: rule.type,
                                category: rule.category
                            });
                            
                            if (rule.type.indexOf('spelling') !== -1) errorCount.spelling++;
                            else if (rule.type.indexOf('grammar') !== -1) errorCount.grammar++;
                            else if (rule.type.indexOf('tense') !== -1) errorCount.tense++;
                            else if (rule.type.indexOf('article') !== -1) errorCount.article++;
                            else if (rule.type.indexOf('punctuation') !== -1) errorCount.punctuation++;
                        }
                        
                    } catch (err) {
                        console.error('Rule error:', err);
                    }
                });

                findings.sort(function(a, b) { return a.start - b.start; });
                
                const cleanFindings = [];
                let lastEnd = 0;
                findings.forEach(function(item) {
                    if (item.start >= lastEnd) {
                        cleanFindings.push(item);
                        lastEnd = item.end;
                    }
                });

                let html = "";
                let cursor = 0;

                cleanFindings.forEach(function(item) {
                    html += escapeHtml(text.substring(cursor, item.start));
                    html += '<span class="err ' + item.type + '" data-tip="' + item.category + ': ' + escapeHtml(item.tip) + '">' + escapeHtml(item.word) + '</span>';
                    cursor = item.end;
                });

                html += escapeHtml(text.substring(cursor));

                if (cleanFindings.length > 0) {
                    outputEl.innerHTML = html;
                    
                    let statusMsg = '<span class="success">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ' + cleanFindings.length + ' ‡∏à‡∏∏‡∏î</span><br><small>';
                    if (errorCount.spelling > 0) statusMsg += '‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î: ' + errorCount.spelling + ' ';
                    if (errorCount.grammar > 0) statusMsg += '‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå: ' + errorCount.grammar + ' ';
                    if (errorCount.tense > 0) statusMsg += 'Tense: ' + errorCount.tense + ' ';
                    if (errorCount.article > 0) statusMsg += '‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: ' + errorCount.article + ' ';
                    if (errorCount.punctuation > 0) statusMsg += '‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï‡∏≠‡∏ô: ' + errorCount.punctuation;
                    statusMsg += '</small>';
                    
                    statusEl.innerHTML = statusMsg;
                } else {
                    outputEl.innerHTML = escapeHtml(text);
                    statusEl.innerHTML = '<span class="success">‚úÖ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</span>';
                }

            } catch (error) {
                console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
                outputEl.innerHTML = '<div class="empty-state" style="color: #e53e3e;">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message + '</div>';
                statusEl.innerHTML = '<span class="error">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ</span>';
            } finally {
                btn.disabled = false;
                btn.innerText = "üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö";
            }

        }, 100);
    }

    function resetForm() {
        document.getElementById('inputText').value = '';
        document.getElementById('result').innerHTML = '<div class="empty-state">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"</div>';
        document.getElementById('status').innerHTML = '';
        document.getElementById('inputText').focus();
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    window.addEventListener('load', function() {
        document.getElementById('inputText').focus();
    });
    
    document.getElementById('inputText').addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            checkGrammar();
        }
    });
</script>

</body>
</html>
