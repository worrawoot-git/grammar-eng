<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Grammar Checker</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&family=Courier+Prime&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --primary: #2563eb;
            --white: #ffffff;
            /* Colors for errors */
            --col-spell: #dc2626;   /* Red */
            --bg-spell: #fef2f2;
            --col-gram: #16a34a;    /* Green */
            --bg-gram: #f0fdf4;
            --col-art: #ea580c;     /* Orange */
            --bg-art: #fff7ed;
            --col-punct: #2563eb;   /* Blue */
            --bg-punct: #eff6ff;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-color);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 { text-align: center; color: #1e293b; margin-top: 0; }

        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }
        .tag { padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .tag-red { background: var(--bg-spell); color: var(--col-spell); border: 1px solid var(--col-spell); }
        .tag-green { background: var(--bg-gram); color: var(--col-gram); border: 1px solid var(--col-gram); }
        .tag-orange { background: var(--bg-art); color: var(--col-art); border: 1px solid var(--col-art); }
        .tag-blue { background: var(--bg-punct); color: var(--col-punct); border: 1px solid var(--col-punct); }

        .controls {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            margin: 0 5px;
            color: white;
        }
        .btn-check { background-color: var(--primary); }
        .btn-check:hover { background-color: #1d4ed8; }
        .btn-print { background-color: #475569; }
        .btn-print:hover { background-color: #334155; }
        .btn-reset { background-color: #ef4444; } /* Reset Red */

        .editor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        textarea, .output-box {
            width: 100%;
            height: 400px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Courier Prime', monospace;
            font-size: 16px;
            resize: vertical;
            box-sizing: border-box;
            line-height: 1.8;
        }

        textarea:focus { outline: 2px solid var(--primary); border-color: transparent; }
        
        .output-box {
            background-color: white;
            overflow-y: auto;
            white-space: pre-wrap; /* Keep formatting */
        }

        /* Highlight Styles */
        .err {
            border-bottom: 3px solid;
            cursor: pointer;
            position: relative;
        }
        .err-spell { border-color: var(--col-spell); background: var(--bg-spell); color: var(--col-spell); }
        .err-gram { border-color: var(--col-gram); background: var(--bg-gram); color: var(--col-gram); }
        .err-art { border-color: var(--col-art); background: var(--bg-art); color: var(--col-art); }
        .err-punct { border-color: var(--col-punct); background: var(--bg-punct); color: var(--col-punct); }

        /* Tooltip */
        .err:hover::after {
            content: attr(data-fix);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        @media print {
            .input-section, .controls, .legend, h1 { display: none; }
            .container { box-shadow: none; border: none; padding: 0; margin: 0; width: 100%; max-width: 100%; }
            .editor-grid { display: block; }
            .output-box { border: none; height: auto; overflow: visible; font-size: 12pt; padding: 0; color: black; }
            
            /* Print friendly highlights */
            .err { border: none; text-decoration: underline; color: black !important; background: none !important; font-weight: bold; }
            .err::after {
                content: " [" attr(data-clean) "] "; /* Show correction in text */
                position: static;
                font-size: 0.8em;
                font-weight: normal;
                color: #555;
                background: none;
                border: 1px solid #ccc;
                padding: 0 4px;
                border-radius: 4px;
                margin-left: 5px;
                transform: none;
                display: inline;
                box-shadow: none;
            }
        }

        @media (max-width: 768px) {
            .editor-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìù Grammar Checker</h1>

    <div class="legend">
        <span class="tag tag-red">Spelling (‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î)</span>
        <span class="tag tag-orange">Articles (a/an/the)</span>
        <span class="tag tag-green">Grammar & Tense</span>
        <span class="tag tag-blue">Punctuation</span>
    </div>

    <div class="controls">
        <button class="btn btn-check" onclick="runCheck()">üîç Check (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö)</button>
        <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Print PDF</button>
        <button class="btn btn-reset" onclick="resetAll()">üóëÔ∏è Reset</button>
    </div>

    <div class="editor-grid">
        <div class="input-section">
            <label><strong>Input Text:</strong></label>
            <textarea id="inputText" placeholder="Type or paste English text here..."></textarea>
        </div>
        <div>
            <label><strong>Result:</strong></label>
            <div id="outputText" class="output-box"></div>
        </div>
    </div>
</div>

<script>
    // ---------------------------------------------------------
    // 1. RULES DATABASE (‡πÉ‡∏ä‡πâ RegExp Object ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error)
    // ---------------------------------------------------------
    const rules = [
        // --- SPELLING (Red) ---
        { pattern: /\b(teh)\b/gi, fix: "the", type: "spell" },
        { pattern: /\b(recieve)\b/gi, fix: "receive", type: "spell" },
        { pattern: /\b(tommorow)\b/gi, fix: "tomorrow", type: "spell" },
        { pattern: /\b(definately)\b/gi, fix: "definitely", type: "spell" },
        { pattern: /\b(becuase)\b/gi, fix: "because", type: "spell" },
        { pattern: /\b(untill)\b/gi, fix: "until", type: "spell" },
        { pattern: /\b(wanna)\b/gi, fix: "want to", type: "spell" },

        // --- ARTICLES (Orange) ---
        { pattern: /\b(a)\s+(apple|elephant|ice|orange|umbrella|hour|idea)\b/gi, fix: "an $2", type: "art" },
        { pattern: /\b(an)\s+(car|book|house|university|year|cat|dog)\b/gi, fix: "a $2", type: "art" },

        // --- GRAMMAR & TENSE (Green) ---
        { pattern: /\b(he|she|it|John|Mary)\s+(have)\b/gi, fix: "has", type: "gram" },
        { pattern: /\b(I)\s+(has)\b/gi, fix: "have", type: "gram" },
        { pattern: /\b(did|didn't)\s+(went|saw|ate|came|took)\b/gi, fix: "did + verb1", type: "gram" },
        { pattern: /\b(will|can|could|should)\s+(to)\b/gi, fix: "remove 'to'", type: "gram" },
        { pattern: /\b(to)\s+(went|goes|gone)\b/gi, fix: "to go", type: "gram" },
        { pattern: /\b(your)\s+(welcome)\b/gi, fix: "you're welcome", type: "gram" },

        // --- PUNCTUATION (Blue) ---
        { pattern: /\s+([.,?!])/g, fix: "$1", type: "punct" }, // Space before dot
        { pattern: /,([^ \n])/g, fix: ", $1", type: "punct" } // No space after comma
    ];

    // ---------------------------------------------------------
    // 2. MAIN FUNCTION
    // ---------------------------------------------------------
    function runCheck() {
        const inputEl = document.getElementById('inputText');
        const outputEl = document.getElementById('outputText');
        let text = inputEl.value;

        if (!text.trim()) {
            alert("Please enter some text first.");
            return;
        }

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        let findings = [];

        // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏Å‡∏é
        rules.forEach(rule => {
            try {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Regex ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠ reset lastIndex
                // rule.pattern ‡∏Ñ‡∏∑‡∏≠ RegExp object ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
                let regex = new RegExp(rule.pattern); 
                let match;

                while ((match = regex.exec(text)) !== null) {
                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏≥ ‡πÄ‡∏ä‡πà‡∏ô $1, $2)
                    let suggestion = rule.fix;
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ Group replacement ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (suggestion.includes("$")) {
                         // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏ä‡∏±‡∏ô replace ‡∏Ç‡∏≠‡∏á string ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤ $1, $2 ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏ö‡∏ó
                         suggestion = match[0].replace(regex, rule.fix);
                    }

                    findings.push({
                        start: match.index,
                        end: match.index + match[0].length,
                        word: match[0],
                        suggestion: suggestion,
                        type: rule.type
                    });

                    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Infinite Loop ‡∏Å‡∏£‡∏ì‡∏µ Regex ‡∏à‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á (Zero-width match)
                    if (match.index === regex.lastIndex) {
                        regex.lastIndex++;
                    }
                }
            } catch (e) {
                console.error("Rule Error:", e);
            }
        });

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å
        findings.sort((a, b) => a.start - b.start);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÉ‡∏´‡∏°‡πà
        let htmlBuilder = "";
        let lastIndex = 0;

        findings.forEach(item => {
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (Overlap Protection)
            // ‡∏ñ‡πâ‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∏‡∏î‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ
            if (item.start < lastIndex) return;

            // 1. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î
            htmlBuilder += escapeHtml(text.substring(lastIndex, item.start));

            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Tag Highlight
            // data-fix: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡πâ‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ
            // data-clean: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏≠‡∏ô‡∏õ‡∏£‡∏¥‡πâ‡∏ô
            htmlBuilder += `<span class="err err-${item.type}" 
                                  data-fix="‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô: ${item.suggestion}" 
                                  data-clean="${item.suggestion}">
                                  ${escapeHtml(item.word)}
                            </span>`;

            lastIndex = item.end;
        });

        // 3. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏ô‡∏à‡∏ö
        htmlBuilder += escapeHtml(text.substring(lastIndex));

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        outputEl.innerHTML = htmlBuilder;
    }

    function resetAll() {
        if(confirm("Clear all text?")) {
            document.getElementById('inputText').value = "";
            document.getElementById('outputText').innerHTML = "";
        }
    }

    // Helper: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô XSS ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    function escapeHtml(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
</script>

</body>
</html>
