<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart English Grammar & Spell Checker</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f3f4f6;
            --surface-color: #ffffff;
            --error-color: #dc2626;
            --warning-color: #d97706;
            --text-color: #1f2937;
            --success-color: #059669;
            --reset-color: #6b7280;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--surface-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: var(--primary-color);
            margin-top: 0;
        }

        p { color: #4b5563; }

        .editor-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-box, .output-box {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }

        textarea {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            resize: vertical;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            box-sizing: border-box; /* Fix padding width issue */
        }

        textarea:focus {
            outline: 2px solid var(--primary-color);
            border-color: transparent;
        }

        .output-div {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background-color: #fafafa;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* Styles for errors */
        .highlight-error {
            text-decoration: underline wavy var(--error-color);
            background-color: rgba(220, 38, 38, 0.1);
            cursor: pointer;
            position: relative;
            padding: 0 2px;
            border-radius: 2px;
        }

        .highlight-error:hover {
            background-color: rgba(220, 38, 38, 0.2);
        }

        /* Tooltip styling */
        .highlight-error:hover::after {
            content: attr(data-suggestion);
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        /* Tooltip Arrow */
        .highlight-error:hover::before {
            content: '';
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
            z-index: 100;
        }

        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-check { background-color: var(--primary-color); }
        .btn-check:hover { background-color: #1d4ed8; }

        .btn-print { background-color: var(--success-color); }
        .btn-print:hover { background-color: #047857; }

        .btn-reset { background-color: var(--reset-color); }
        .btn-reset:hover { background-color: #4b5563; }

        .summary-section {
            margin-top: 30px;
            padding: 25px;
            background-color: #eff6ff;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
        }
        
        .summary-list li {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dbeafe;
        }
        .summary-list li:last-child {
            border-bottom: none;
        }

        /* Print Specific Styles */
        @media print {
            body {
                background-color: white;
                padding: 0;
                font-size: 12pt;
            }
            .container {
                box-shadow: none;
                width: 100%;
                max-width: 100%;
                padding: 0;
            }
            .input-box, .btn, .controls, header p {
                display: none !important;
            }
            .output-box {
                flex: 100%;
                border: none;
                margin-top: 0;
            }
            .output-div {
                border: none;
                height: auto;
                background-color: white;
                padding: 0;
                overflow: visible;
                font-size: 14pt;
                line-height: 2;
            }
            .highlight-error {
                text-decoration: none;
                font-weight: bold;
                color: var(--error-color);
                background: none;
            }
            /* Show suggestions in print explicitly */
            .highlight-error::after {
                content: " [" attr(data-clean-suggestion) "] ";
                position: static;
                background: none;
                color: var(--text-color);
                font-size: 0.9em;
                font-weight: normal;
                border: 1px solid #ccc;
                padding: 2px 5px;
                border-radius: 4px;
                margin-left: 5px;
                box-shadow: none;
                transform: none;
                display: inline;
            }
            .highlight-error:hover::before { display: none; }
            
            .summary-section {
                border: 1px solid #ccc;
                background-color: white;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>üìù English Grammar & Spell Checker</h1>
            <p>‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ</p>
        </header>

        <div class="controls">
            <button class="btn btn-check" onclick="checkGrammar()">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Check)</button>
            <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (PDF)</button>
            <button class="btn btn-reset" onclick="resetPage()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï (Reset)</button>
        </div>

        <div class="editor-section">
            <div class="input-box">
                <label><strong>‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (Input):</strong></label>
                <textarea id="inputText" spellcheck="true" lang="en" placeholder="Type or paste your English text here... 
Example: He have a car. I definately want to went home. Thier house is big."></textarea>
            </div>
            
            <div class="output-box">
                <label><strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à (Result):</strong></label>
                <div id="resultOutput" class="output-div"></div>
            </div>
        </div>

        <div id="summarySection" class="summary-section" style="display: none;">
            <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Analysis Report)</h2>
            <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> <span id="errorCount" style="color: var(--error-color); font-weight: bold;">0</span> ‡∏à‡∏∏‡∏î</p>
            <hr>
            <ul id="suggestionList" class="summary-list"></ul>
            <p style="font-size: 0.9em; margin-top: 20px; color: #666;">
                <em>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏Å‡∏é‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Rule-based) ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢ ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</em>
            </p>
        </div>
    </div>

    <script>
        // ‡∏£‡∏ß‡∏°‡∏Å‡∏é Grammar ‡πÅ‡∏•‡∏∞ Spelling Common Mistakes
        const rules = [
            // --- Grammar Rules ---
            { pattern: /\b(he|she|it)\s+have\b/gi, suggestion: "has", reason: "Grammar: ‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÄ‡∏≠‡∏Å‡∏û‡∏à‡∏ô‡πå‡πÉ‡∏ä‡πâ has" },
            { pattern: /\b(I)\s+has\b/gi, suggestion: "have", reason: "Grammar: I ‡πÉ‡∏ä‡πâ have" },
            { pattern: /\b(dont)\b/gi, suggestion: "don't", reason: "Punctuation: ‡∏Ç‡∏≤‡∏î apostrophe" },
            { pattern: /\b(cant)\b/gi, suggestion: "can't", reason: "Punctuation: ‡∏Ç‡∏≤‡∏î apostrophe" },
            { pattern: /\b(im)\b/gi, suggestion: "I'm", reason: "Punctuation: ‡∏Ç‡∏≤‡∏î apostrophe" },
            { pattern: /\b(your)\s+(welcome)\b/gi, suggestion: "you're welcome", reason: "Grammar: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ You are (You're)" },
            { pattern: /\b(to)\s+went\b/gi, suggestion: "to go", reason: "Grammar: ‡∏´‡∏•‡∏±‡∏á to ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ Verb ‡∏ä‡πà‡∏≠‡∏á 1" },
            { pattern: /\b(can)\s+to\b/gi, suggestion: "can", reason: "Grammar: Modal verb ‡πÑ‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ to" },
            
            // --- Common Spelling Mistakes (Spelling) ---
            { pattern: /\b(teh)\b/gi, suggestion: "the", reason: "Spelling: ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠ the" },
            { pattern: /\b(recieve)\b/gi, suggestion: "receive", reason: "Spelling: i ‡∏Å‡πà‡∏≠‡∏ô e (except after c)" },
            { pattern: /\b(definately)\b/gi, suggestion: "definitely", reason: "Spelling: ‡∏™‡∏∞‡∏Å‡∏î‡∏ú‡∏¥‡∏î" },
            { pattern: /\b(seperate)\b/gi, suggestion: "separate", reason: "Spelling: ‡∏™‡∏∞‡∏Å‡∏î‡∏ú‡∏¥‡∏î (‡πÉ‡∏ä‡πâ a ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà e)" },
            { pattern: /\b(occured)\b/gi, suggestion: "occurred", reason: "Spelling: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ r ‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß" },
            { pattern: /\b(alot)\b/gi, suggestion: "a lot", reason: "Spelling: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ" },
            { pattern: /\b(thier)\b/gi, suggestion: "their", reason: "Spelling: ‡∏™‡∏∞‡∏Å‡∏î‡∏ú‡∏¥‡∏î" },
            { pattern: /\b(untill)\b/gi, suggestion: "until", reason: "Spelling: until ‡∏°‡∏µ l ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß" },
            { pattern: /\b(truely)\b/gi, suggestion: "truly", reason: "Spelling: ‡∏ï‡∏±‡∏î e ‡∏≠‡∏≠‡∏Å" },
            { pattern: /\b(wether)\b/gi, suggestion: "whether", reason: "Spelling: ‡∏≠‡∏≤‡∏à‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á weather ‡∏´‡∏£‡∏∑‡∏≠ whether" },
            
            // --- Formatting ---
            { pattern: /\s{2,}/g, suggestion: " ", reason: "Format: ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô" }
        ];

        function checkGrammar() {
            const inputText = document.getElementById('inputText').value;
            const resultDiv = document.getElementById('resultOutput');
            const summarySection = document.getElementById('summarySection');
            const errorCountSpan = document.getElementById('errorCount');
            const suggestionList = document.getElementById('suggestionList');

            if (!inputText.trim()) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö");
                return;
            }

            let matches = [];

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
            rules.forEach(rule => {
                let match;
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Regex ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠ reset lastIndex
                const regex = new RegExp(rule.pattern);
                while ((match = regex.exec(inputText)) !== null) {
                    matches.push({
                        start: match.index,
                        end: match.index + match[0].length,
                        text: match[0],
                        suggestion: rule.suggestion,
                        reason: rule.reason
                    });
                }
            });

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å
            matches.sort((a, b) => a.start - b.start);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML Output
            let finalHtml = "";
            let lastIndex = 0;
            let totalErrors = 0;
            
            suggestionList.innerHTML = ""; // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤

            matches.forEach((m) => {
                // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (Overlap protection)
                if (m.start >= lastIndex) {
                    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏ú‡∏¥‡∏î
                    finalHtml += escapeHtml(inputText.substring(lastIndex, m.start));
                    
                    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î (Highlight)
                    // data-clean-suggestion ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏≠‡∏ô Print
                    finalHtml += `<span class="highlight-error" 
                        title="${m.reason}" 
                        data-suggestion="üí° ${m.suggestion}" 
                        data-clean-suggestion="‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô: ${m.suggestion}">
                        ${escapeHtml(m.text)}
                    </span>`;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏£‡∏∏‡∏õ
                    let li = document.createElement('li');
                    li.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span>‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏û‡∏ö: <strong style="color:var(--error-color); text-decoration:line-through;">${escapeHtml(m.text)}</strong></span>
                            <span style="color:var(--success-color); font-weight:bold;">‚ûî ${m.suggestion}</span>
                        </div>
                        <div style="font-size:0.9em; color:#666; margin-top:4px;">${m.reason}</div>
                    `;
                    suggestionList.appendChild(li);
                    
                    totalErrors++;
                    lastIndex = m.end;
                }
            });

            // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            finalHtml += escapeHtml(inputText.substring(lastIndex));

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            resultDiv.innerHTML = finalHtml;
            errorCountSpan.innerText = totalErrors;
            summarySection.style.display = "block";
            
            // Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
            if(window.innerWidth < 768) {
                resultDiv.scrollIntoView({behavior: "smooth"});
            }
        }

        function resetPage() {
            if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                document.getElementById('inputText').value = '';
                document.getElementById('resultOutput').innerHTML = '';
                document.getElementById('summarySection').style.display = 'none';
                document.getElementById('errorCount').innerText = '0';
                document.getElementById('suggestionList').innerHTML = '';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô XSS ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢
        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
